<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>GrapesJS Preset Webpage</title>
    <link href="https://unpkg.com/grapesjs/dist/css/grapes.min.css" rel="stylesheet">
<link href="https://unpkg.com/grapesjs-plugin-toolbox/dist/grapesjs-plugin-toolbox.min.css" rel="stylesheet">
<script src="https://unpkg.com/grapesjs"></script>
<script src="https://unpkg.com/grapesjs-plugin-toolbox"></script>
<script src="//feather.aviary.com/imaging/v3/editor.js"></script>
<script src="path/to/grapes.min.js"></script>
<script src="path/to/grapesjs-aviary.min.js"></script>

<script src="path/to/grapesjs-plugin-forms.min.js"></script>
<script src="path/to/grapesjs-tooltip.min.js"></script>
<script src="path/to/grapesjs-blocks-flexbox.min.js"></script>
	  <script src="https://unpkg.com/grapesjs-preset-newsletter"></script>
	    <script src="https://unpkg.com/grapesjs-preset-webpage"></script>
   <script src="https://cdn.ckeditor.com/4.21.0/standard-all/ckeditor.js"></script>
<link rel="manifest" href="%PUBLIC_URL%/manifest.json">
  
    <script src="https://unpkg.com/grapesjs-preset-webpage@1.0.2"></script>
    <script src="https://unpkg.com/grapesjs-blocks-basic@1.0.1"></script>
    <script src="https://unpkg.com/grapesjs-plugin-forms@2.0.5"></script>
    <script src="https://unpkg.com/grapesjs-component-countdown@1.0.1"></script>
    <script src="https://unpkg.com/grapesjs-plugin-export@1.0.11"></script>
    <script src="https://unpkg.com/grapesjs-tabs@1.0.6"></script>
    <script src="https://unpkg.com/grapesjs-custom-code@1.0.1"></script>
    <script src="https://unpkg.com/grapesjs-touch@0.1.1"></script>
    <script src="https://unpkg.com/grapesjs-parser-postcss@1.0.1"></script>
    <script src="https://unpkg.com/grapesjs-tooltip@0.1.7"></script>
    <script src="https://unpkg.com/grapesjs-tui-image-editor@0.1.3"></script>
    <script src="https://unpkg.com/grapesjs-typed@1.0.5"></script>
    <script src="https://unpkg.com/grapesjs-style-bg@2.0.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.3.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <style>
      body,
      html {
        height: 100%;
        margin: 0;
      }
    </style>
  </head>


   <body>
    <div><input type="hidden" id="myHiddenField" name="myHiddenField"></div>
    <div id="root" style="height:0px; overflow:hidden;">

    </div>
 
    <script>

        function getPageParameters() {
            const url = window.location.href;
            const dd = window.location.pathname;

            if (url.includes('get')) {
    
                const age = 30; 

                fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer YOUR_AUTH_TOKEN',
                        'X-User-Age': age,
                    },
                })
                  

                    .then(response => response.text())
                    .then(data => {

                        editor.setComponents(data);
                     
                    });

            }

        }









    </script>
    <script type="text/javascript">

        window.onload = () => {
            window.editor = grapesjs.init({
                container: '#root',
                fromElement: true,
                plugins: [

                    'gjs-blocks-basic',
                    'grapesjs-plugin-forms',
                    'grapesjs-component-countdown',
                    'grapesjs-plugin-export',
                    'grapesjs-tabs',
                    'grapesjs-custom-code',
                    'grapesjs-touch',
                    'grapesjs-parser-postcss',
                    'grapesjs-tooltip',
                    'grapesjs-tui-image-editor',
                    'grapesjs-typed',
                    'grapesjs-typed',
                    'grapesjs-style-bg',
                    'grapesjs-preset-webpage',
                    'gjs-plugin-ckeditor'

                ],
                pluginsOpts: {
                    'gjs-blocks-basic': { flexGrid: true },
                    'grapesjs-tui-image-editor': {
                        script: [
                            'https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.6.7/fabric.min.js',
                            'https://uicdn.toast.com/tui.code-snippet/v1.5.2/tui-code-snippet.min.js',
                            'https://uicdn.toast.com/tui-color-picker/v2.2.7/tui-color-picker.min.js',
                            'https://uicdn.toast.com/tui-image-editor/v3.15.2/tui-image-editor.min.js'
                        ],
                        style: [
                            'https://uicdn.toast.com/tui-color-picker/v2.2.7/tui-color-picker.min.css',
                            'https://uicdn.toast.com/tui-image-editor/v3.15.2/tui-image-editor.min.css',
                        ],
                    },
                    'grapesjs-tabs': {
                        tabsBlock: { category: 'Extra' }
                    },
                    'grapesjs-typed': {
                        block: {
                            category: 'Extra',
                            content: {
                                type: 'typed',
                                'type-speed': 40,
                                strings: [
                                    'Text row one',
                                    'Text row two',
                                    'Text row three',
                                ],
                            }
                        }
                    },
                    'grapesjs-preset-webpage': {


                    },

                    'grapesjs-plugin-export': {

                    },

                    'gjs-plugin-ckeditor': {
                        options: {
                            language: 'fr',
                            extraPlugins: 'colorbutton,colordialog',
                            autoParagraph: false,
                            enterMode: 2,
                            toolbar: [
                                { name: 'styles', items: ['Format'] },
                                { name: 'basicstyles', items: ['Bold', 'Italic', 'Underline', 'Strike'], },
                                { name: 'paragraph', items: ['NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'Blockquote'] },
                                { name: 'colors', items: ['TextColor', 'BGColor'] },
                                { name: 'clipboard', items: ['Undo', 'Redo'] },
                            ]
                        }
                    },
                },

                styleManager: {
                    sectors: [{
                        name: 'General',
                        open: false,
                        buildProps: ['float', 'display', 'position', 'top', 'right', 'left', 'bottom']
                    }, {
                        name: 'Flex',
                        open: false,
                        buildProps: ['flex-direction', 'flex-wrap', 'justify-content', 'align-items', 'align-content', 'order', 'flex-basis', 'flex-grow', 'flex-shrink', 'align-self']
                    }, {
                        name: 'Dimension',
                        open: false,
                        buildProps: ['width', 'height', 'max-width', 'min-height', 'margin', 'padding'],
                    }, {
                        name: 'Typography',
                        open: false,
                        buildProps: ['font-family', 'font-size', 'font-weight', 'letter-spacing', 'color', 'line-height', 'text-shadow'],
                    }, {
                        name: 'Decorations',
                        open: false,
                        buildProps: ['border-radius-c', 'background-color', 'border-radius', 'border', 'box-shadow', 'background'],
                    }, {
                        name: 'Extra',
                        open: false,
                        buildProps: ['transition', 'perspective', 'transform'],
                    }
                    ],
                },


            });

            editor.Panels.addButton('options', [{
                id: 'options-toggle',
                className: 'dropdownicon',
                command: 'toggle-options',
                attributes: { title: 'Champs de fusion', id: 'optionschamp', name: 'optionschamp', class: 'dropdown-container', onchange: 'submitForm()' },
                tagName: 'select',
                traits: ['name', 'value'],

            }]);





            editor.Commands.add('toggle-options', {

                run(editor) {


                    $.ajax({
                        type: 'GET',
                        url: 'LoadListChamp',

                        success: function (jsonData) {
                            var data = JSON.stringify(jsonData);



                            var dropdownList = $('#optionschamp');
                            var dropdownHtml = jsonData;
                            $("#optionschamp").html(dropdownHtml);

                            dropdownList.bind();

                        },

                    });
                },
            });



            editor.Panels.addButton('options', [{
                id: 'htmlEn',
                className: 'englishlangicon',
                command: 'htmlEn',
                attributes: {
                    title: 'charger le contenu en anglais'
                }

            }]);

            editor.Commands.add('htmlEn', {
                run: function (editor) {

                    fetch('TransEn')
                        .then(response => response.text())
                        .then(data => {
                            editor.setComponents([]);
                            editor.setComponents(data);

                        });

                }
            });
            editor.Panels.addButton('options', [{
                id: 'htmlFr',
                className: 'frenchlangicon',
                command: 'htmlFr',
                attributes: {
                    title: 'Charger le contenu en français'
                }

            }]);


            editor.Commands.add('htmlFr', {
                run: function (editor) {

                    fetch('TransFr')
                        .then(response => response.text())
                        .then(data => {
                            editor.setComponents([]);
                            editor.setComponents(data);

                        });

                }
            });
            editor.Panels.addButton('options', [{
                id: 'export',
                className: 'sauvegardericon',
                command: 'export',
                attributes: { title: 'Sauvegarder en base' }
            }]);
            editor.Commands.add('export', {



                run: function (editor) {
                    const url = window.location.href;
                    if (url.includes('getcamp')) {
                        const designData2 = editor.getHtml();
                        const data2 = {
                            Fichier: designData2,
                            FichierUs: designData2,

                        };
                        fetch('/SaveCamp/', {
                            method: 'post',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(data2)
                        })
                            .then(response => response.json())
                            .then(data2 => {
                                alert(`New user added: ${data2.Description}`);
                            });


                    }

                    else {
                        const designData = editor.getHtml();
                        const data = {
                            ContenuFr: designData,
                            ContenuUs: designData,

                        };


                        fetch('/Save/', {
                            method: 'post',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(data)
                        })
                            .then(response => response.json())
                            .then(data => {
                                alert(`New user added: ${data.Description}`);
                            });
                    }
                }




            });

            editor.on('load', getPageParameters);
        };

    </script>

   
    <script>
        function submitForm() {
            var dropdown = document.getElementById("optionschamp");
            var selectedText = dropdown.options[dropdown.selectedIndex].text;
             navigator.clipboard.writeText('<strong>' + '{[' + selectedText + ']}' + '</strong>');
            alert(`Le champ de fusion ${selectedText} est copié.`);

        }
    </script>
  </body>
</html>